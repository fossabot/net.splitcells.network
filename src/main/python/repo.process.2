#!/usr/bin/env python3
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

import subprocess
import sys
import argparse
import json
from pathlib import Path

# TODO Support relative path.
# TODO Support host.

def execute(relativePath, host, command):
	print(Path('.').resolve())
	print(command)
	subprocess.call(command, shell='True')
def process(relativePath, host, command):
	execute(relativePath, host, command)
	subListPath=Path('./.net.splitcells.os.state.interface.repo/subs.json')
	if subListPath.is_file():
		with open(subListPath, 'r') as subListFile:
			repoList=json.load(subListFile)
			for subName in repoList['subs'].keys():
				r='/home/splitcells/Documents/projects/net.splitcells.martins.avots.support.system/public/net.splitcells.os.state.interface/src/main/python/repo.process.2'
				subRepoCommand = 'cd ' + subName + ' ; ' + r + ' --command=' + command # + ' --host=' + host + ' --relativePath=' + relativePath
				print(subRepoCommand)
				subprocess.call(subRepoCommand, shell='True')
if __name__ == '__main__':
	parser = argparse.ArgumentParser(description='TODO')
	parser.add_argument('--relative-path', dest='relativePath', default='./')
	parser.add_argument('--host', dest='host', default="''")
	parser.add_argument('--command', dest='command', required=True)
	parsedArgs = parser.parse_args()
	process(parsedArgs.relativePath, parsedArgs.host, parsedArgs.command)
